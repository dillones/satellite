function Satellite(d){document.addEventListener("contextmenu",function(a){a.preventDefault()},!1);var a=this,e=!1;this.camera=d;this.TOUCH=this.SECONDARY_CLICK=this.PRIMARY_CLICK=!1;this.TOUCHES=[];this.LAST=[];for(d=this.mode=0;2>d;d++)a.TOUCHES[d]=new THREE.Vector3,this.LAST[d]=new THREE.Vector3;this.direct=new THREE.Vector3;this.roll=new THREE.Vector3(0,0,1);this.yaw=new THREE.Vector3(0,-1,0);this.pitch=new THREE.Vector3(-1,0,0);this.target=new THREE.Vector3(0,0,0);this.yaw_vel=this.roll_vel=this.pitch_vel=
this.z=0;this.damp=.5;this.acc=.0045;this.update=function(){a.PRIMARY_CLICK||a.TOUCH?(this.yaw_vel=this.direct.x*this.acc,this.pitch_vel=this.direct.y*this.acc):(this.yaw_vel*=.9,this.pitch_vel*=.9);a.SECONDARY_CLICK?(this.roll_vel=this.direct.x*this.acc,this.z=this.direct.y):this.roll_vel*=.88;this.z*=.5;var b=this.camera.fov+this.z;30<=b&&120>=b?(this.camera.fov=b,this.camera.updateProjectionMatrix()):30>b?(this.camera.fov=30,this.camera.updateProjectionMatrix()):120<b&&(this.camera.fov=120,this.camera.updateProjectionMatrix());
this.pitch.applyAxisAngle(this.yaw,this.yaw_vel);this.pitch.applyAxisAngle(this.roll,this.roll_vel);this.roll.applyAxisAngle(this.pitch,this.pitch_vel);this.roll.applyAxisAngle(this.yaw,this.yaw_vel);this.yaw.applyAxisAngle(this.pitch,this.pitch_vel);this.yaw.applyAxisAngle(this.roll,this.roll_vel);this.camera.up.applyAxisAngle(this.pitch,this.pitch_vel);this.camera.up.applyAxisAngle(this.roll,this.roll_vel);this.camera.up.applyAxisAngle(this.yaw,this.yaw_vel);this.camera.position.applyAxisAngle(this.pitch,
this.pitch_vel);this.camera.position.applyAxisAngle(this.roll,this.roll_vel);this.camera.position.applyAxisAngle(this.yaw,this.yaw_vel);this.camera.lookAt(this.target);.001<this.direct.length()?this.direct.multiplyScalar(.8):this.direct.set(0,0,0);this.z=.001<Math.abs(this.z)?.99*this.z:0};this.start=function(b){switch(b.touches.length){case 1:a.TOUCHES[0].set(b.touches[0].clientX,b.touches[0].clientY,0);a.LAST[0].copy(a.TOUCHES[0]);e=!1;a.TOUCH=!0;break;case 2:for(var c=0;c<a.TOUCHES.length;c++)a.TOUCHES[c].set(b.touches[c].clientX,
b.touches[c].clientY,0),a.LAST[c].copy(a.TOUCHES[c]);e=!0}};this.move=function(b){switch(b.touches.length){case 1:e?(a.TOUCHES[0].set(b.touches[0].clientX,b.touches[0].clientY,0),a.LAST[0].copy(a.TOUCHES[0]),e=!1):(a.TOUCHES[0].set(b.touches[0].clientX,b.touches[0].clientY,0),a.direct.copy(a.TOUCHES[0]),a.direct.sub(a.LAST[0]),a.LAST[0].copy(a.TOUCHES[0]));break;case 2:a.TOUCHES[0].set(b.touches[0].clientX,b.touches[0].clientY,0);a.TOUCHES[1].set(b.touches[1].clientX,b.touches[1].clientY,0);b=a.TOUCHES[0].distanceTo(a.TOUCHES[1]);
var c=a.LAST[0].distanceTo(a.LAST[1]);a.z=Math.round(c-b);for(b=0;b<a.TOUCHES.length;b++)a.LAST[b].copy(a.TOUCHES[b])}};this.release=function(b){a.TOUCH=!1};this.mousedown=function(b){a.TOUCHES[0].set(b.clientX,b.clientY,0);a.LAST[0].copy(a.TOUCHES[0]);switch(b.button){case 0:a.PRIMARY_CLICK=!0;break;case 2:a.SECONDARY_CLICK=!0}};this.mousemove=function(b){if(1==a.PRIMARY_CLICK||1==a.SECONDARY_CLICK)a.TOUCHES[0].set(b.clientX,b.clientY,0),a.direct.copy(a.TOUCHES[0]),a.direct.sub(a.LAST[0]),a.LAST[0].copy(a.TOUCHES[0])};
this.mouseup=function(b){switch(b.button){case 0:a.PRIMARY_CLICK=!1;break;case 2:a.SECONDARY_CLICK=!1}};this.connect=function(){window.addEventListener("touchstart",a.start);window.addEventListener("touchmove",a.move);window.addEventListener("touchend",a.release);window.addEventListener("mousedown",a.mousedown);window.addEventListener("mousemove",a.mousemove);window.addEventListener("mouseup",a.mouseup)};this.disconnect=function(){window.removeEventListener("touchstart",a.start);window.removeEventListener("touchmove",
a.move);window.removeEventListener("touchend",a.release);window.removeEventListener("mousedown",a.mousedown);window.removeEventListener("mousemove",a.mousemove);window.removeEventListener("mouseup",a.mouseup)}};
